parameters:
  ClientID: ''
  ClientSecret: ''
  TenantID: ''

steps:
- task: PythonScript@0
  displayName: Validate azure-cli parameters
  inputs:
    scriptSource: inline
    script: |
      if len('${{ parameters.ClientID }}') == 0:
        raise Exception('Parameter ClientID is empty')

      if len('${{ parameters.ClientSecret }}') == 0:
        raise Exception('Parameter ClientSecret is empty')

      if len('${{ parameters.TenantID }}') == 0:
        raise Exception('Parameter TenantID is empty')

- task: UsePythonVersion@0
  displayName: Use Python 3.x
  inputs:
    versionSpec: '3.x'
    architecture: x64

- script: |
    python -m pip install --upgrade pip
    pip install azure-cli
    az --version
  displayName: Update azure-cli

- script: az login --service-principal "${{ parameters.ClientID }}" --password "${{ parameters.ClientSecret }}" --tenant "${{ parameters.TenantID }}"
  displayName: Log into azure-cli
